{% extends 'base_assets.html' %}
{% load static %}
{% load widget_tweaks %}
{% block title %}Asset {{ object.asset_id }}{% endblock %}

{% block css %}
    <link rel="stylesheet" href="//cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
{% endblock %}

{% block preload_js %}
    <script src="//cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
{% endblock %}

{% block js %}
    {% if edit %}
        <script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
        <script src="{% static 'js/interaction.js' %}"></script>
        <script>
          function checkIfCableHidden() {
            if (document.getElementById("id_is_cable").checked) {
              document.getElementById("cable-table").hidden = false;
            } else {
              document.getElementById("cable-table").hidden = true;
            }
          }
          checkIfCableHidden();

          $(document).ready(function () {
              setupMDE('#id_comments');
          });
        </script>
    {% endif %}
{% endblock %}

{% block content %}
    <div class="page-header">
      <h1>
          {% if edit and object %}
              Edit Asset: {{ object.asset_id }}
          {% else %}
              Asset: {{ object.asset_id }}
          {% endif %}
      </h1>
    </div>
    <form method="post" id="asset_update_form" action="{% url 'asset_update' pk=object.asset_id%}">
      {% include 'form_errors.html' %}
      {% csrf_token %}
      <input type="hidden" name="id" value="{{ object.id|default:0 }}" hidden=true>
      <div class="row">
        <div class="col-sm-12">
          {% include 'partials/asset_form.html' %}
        </div>
      </div>
      <div class="row">
        {% if perms.assets.asset_finance %}
        <div class="col-md-6">
          {% include 'partials/purchasedetails_form.html' %}
        </div>
        {%endif%}
        <div class="col-md-6"
        {% if not object.is_cable %} hidden="true" {% endif %} id="cable-table">
          {% include 'partials/cable_form.html' %}
        </div>
        <div class="col-md-4">
          {% include 'partials/parent_form.html' %}
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          {% include 'partials/asset_buttons.html' %}
      </div>
    </form>

    {% if not edit and perms.assets.view_asset %}
    <div class="col-sm-12 text-right">
        <div>
            <a href="{% url 'asset_history' object.asset_id %}" title="View Revision History">
                Last edited at {{ object.last_edited_at|default:'never' }} by {{ object.last_edited_by.name|default:'nobody' }}
            </a>
        </div>
    </div>
    {% endif %}

{% endblock %}
